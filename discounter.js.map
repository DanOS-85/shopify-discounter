{"version":3,"file":"discounter.js","sourceRoot":"","sources":["src/discounter.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {LitElement, html, css} from 'lit';\nimport {customElement, property, state} from 'lit/decorators.js';\nimport { CLOSE_ICON, DISCOUNT_ICON, GIFT_ICON, INFO_ICON, SPINNER_ICON } from './constants';\nimport { DataController, GiftCard, CheckoutData, Discount } from './data-controller';\n// @ts-ignore\nimport { formatMoney } from '@shopify/theme-currency';\n\n/**\n * An example element.\n *\n * @fires count-changed - Indicates when the count changes\n * @slot - This element has a slot\n * @csspart button - The button\n */\n\n@customElement('discounter-form')\nexport class DiscounterForm extends LitElement {\n  static override styles = css`\n    .form--wrapper {\n      padding: 6px 0;\n    }\n    .form {\n      display: flex;\n      flex-wrap: wrap;\n      gap: var(--discounter-form-gap, 12px);\n    }\n    .form input {\n      background: var(--discounter-input-bg-color, white);\n      border: var(--discounter-input-border, 0);\n      border-radius: var(--discounter-input-border-radius, 5px);\n      color: var(--discounter-input-bg-color, inherit);\n      flex: 1 1 0%;\n      padding: 13px 11px;\n    }\n    .form input.error {\n      border: 1px solid #ff6d6d;\n    }\n    .form button {\n      border: 0;\n      border-radius: var(--discounter-button-border-radius, 5px);\n      background: var(--discounter-button-bg-color, black);\n      color: var(--discounter-button-color, white);\n      cursor: pointer;\n      font-weight: 600;\n      padding: 13px 24px;\n      position: relative;\n    }\n    .form button[disabled] {\n      cursor: not-allowed;\n      opacity: 0.4;\n    }\n    .form button svg {\n      visibility: hidden;\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      margin-top: -10px;\n      margin-left: -10px;\n      transition: opacity 0.3s ease-in-out;\n      opacity: 0;\n    }\n    .form button.loading span {\n      visibility: hidden;\n    }\n    .form button.loading svg {\n      animation: rotate 0.5s linear infinite;\n      visibility: visible;\n      opacity: 1;\n    }\n    .message {\n      font-size: 14px;\n      margin: 8px 0 4px;\n    }\n    .message.error {\n      color: #ff6d6d;\n    }\n    .codes {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 10px;\n      margin-top: 12px;\n    }\n    .tooltip {\n      background: var(--discounter-tooltip-bg, white);\n      color: var(--discounter-tooltip-color, black);\n      padding: 6px 16px;\n      border-radius: var(--discounter-tooltip-border-radius, 5px);\n      font-weight: 600;\n      left: 50%;\n      top: 50%;\n      white-space: nowrap;\n    }\n    .code {\n      background-color: var(--discounter-code-bg, #e7f3f6);\n      border-radius: var(--discounter-code-border-radius, 5px);\n      color: var(--discounter-code-color, black);\n      display: inline-flex;\n      gap: 8px;\n      padding: 10px;\n    }\n    .code span {\n      align-items: center;\n      display: flex;\n      font-size: 13px;\n      font-weight: 600;\n      gap: 8px;\n    }\n    .icon {\n      fill: currentColor;\n      height: 18px;\n      width: 18px;\n    }\n    .code button {\n      background: transparent;\n      border: 0;\n      color: var(--discounter-code-color, black);\n      cursor: pointer;\n      padding: 0;\n    }\n    .code button .spinner_icon {\n      animation: rotate 0.5s linear infinite;\n    }\n    .code button .close_icon,\n    .code button.loading .spinner_icon {\n      display: block;\n    }\n    .code button .spinner_icon,\n    .code button.loading .close_icon {\n      display: none;\n    }\n    @keyframes rotate {\n      0% {\n        transform: rotate(0);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n  `;\n\n  @property({type: Boolean, attribute: 'empty-msg'})\n  private emptyMsg = false;\n\n  @state()\n  private error = false;\n\n  @state()\n  private loading = false;\n\n  @state()\n  private code = '';\n\n  private dataFetcher = new DataController(this);\n\n  override updated() {\n    const detail = {data: this.dataFetcher._data};\n    const event = new CustomEvent('discounter-update', {detail, bubbles: true, composed: true, cancelable: true});\n    this.dispatchEvent(event);\n  }\n\n  handleInput(event: InputEvent) {\n    this.error = false;\n    this.code = (event.target as HTMLInputElement)?.value;\n  }\n\n  showTooltip(event: MouseEvent) {\n    const tooltip = (event.currentTarget as HTMLDivElement).firstElementChild as HTMLDivElement;\n    tooltip.style.display = \"block\";\n  }\n  \n  hideTooltip(event: MouseEvent) {\n    const tooltip = (event.currentTarget as HTMLDivElement).firstElementChild as HTMLDivElement;\n    tooltip.style.display = \"none\";\n  }\n\n  async clearDiscount(event: Event, code: string) {\n    await this.dataFetcher.clearDiscount(event, code)\n    this.code = '';\n    this.error = false;\n  }\n\n  async clearGiftCard(event: Event, giftCard: GiftCard) {\n    await this.dataFetcher.clearGiftCard(event, giftCard)\n    this.code = '';\n    this.error = false;\n  }\n\n  private async applyCode() {\n    if (!this.code.length) {\n      return;\n    }\n\n    this.loading = true;\n\n    try {\n      await this.dataFetcher.applyCode(this.code);\n      this.code = '';\n      this.loading = false;\n    } catch (error) {\n      this.loading = false;\n      this.error = true;\n      console.log(error);\n    }\n  }\n\n  private getDiscountsAndGifts() {\n    if (\n      (\n        this.dataFetcher._discounts.length ||\n        this.dataFetcher._gift_cards.length\n      ) && !this.dataFetcher._error\n    ) {\n      return html`<div class=\"codes\">\n        ${this.dataFetcher._discounts.map((discount: Discount) => {\n\n          const markup = discount.application_type === \"automatic\" ?\n          html`<div\n              style=\"position: relative; display: flex;\"\n              @mouseenter=${this.showTooltip}\n              @mouseleave=${this.hideTooltip}\n            >\n              <div class=\"tooltip\" style=\"position: absolute; display: none;\">\n                ${window.discounter_i18n?.tooltip || \"Automatic discount can't be removed\"}\n              </div>\n              ${INFO_ICON}\n            </div>\n          `:\n          html`<button\n              type=\"button\"\n              @click=${(event: Event) => this.clearDiscount(event, discount.title)}\n            >\n              ${CLOSE_ICON}\n              ${SPINNER_ICON}\n            </button>\n          `;\n\n          return html`\n            <div class=\"code\">\n              <span>\n                ${DISCOUNT_ICON}\n                <span>${discount.title.toUpperCase()}</span>\n              </span>\n              ${markup}\n            </div>\n          `;\n        })}\n\n        ${this.dataFetcher._gift_cards.map((gift_card: GiftCard) => {\n\n          return html`\n            <div class=\"code\">\n              <span>\n                ${GIFT_ICON}\n                <span>•••• ${gift_card.last_characters.toUpperCase()}</span>\n              </span>\n              <button\n                type=\"button\"\n                @click=${(event: Event) => this.clearGiftCard(event, gift_card)}\n              >\n                ${CLOSE_ICON}\n                ${SPINNER_ICON}\n              </button>\n            </div>\n          `;\n        })}\n      </div>`;\n    }\n\n    return '';\n  }\n\n  override render() {\n    if (this.dataFetcher._error && this.emptyMsg) {\n      return html`<p>${window.discounter_i18n?.empty_msg || \"Your cart is currently empty.\"}</p>`;\n    }\n\n    const classes = this.loading ? 'loading': '';\n    const errorClass = this.error ? 'error' : '';\n\n    return html`\n      <div class=\"discounter-form\">\n        <div class=\"form--wrapper\">\n          <div class=\"form\">\n            <input\n              type=\"text\"\n              class=${errorClass}\n              placeholder=${window.discounter_i18n?.placeholder || \"Gift card or discount code\"}\n              .value=${this.code}\n              @input=${this.handleInput}\n            >\n            <button\n              type=\"submit\"\n              class=${classes}\n              ?disabled=${this.dataFetcher._error || !this.code.length}\n              @click=${this.applyCode}\n            >\n              <span>${window.discounter_i18n?.apply || 'Apply'}</span>\n              ${SPINNER_ICON}\n            </button>\n          </div>\n\n          ${\n            this.dataFetcher._error\n            ? html`<p class=\"message\">\n              ${window.discounter_i18n?.empty_msg || \"Your cart is currently empty.\"}\n            </p>`\n            : ''\n          }\n\n          ${\n            this.error\n            ? html`<p class=\"message error\">\n              ${window.discounter_i18n?.error_msg || \"Invalid discount code or gift card or invalid combination\"}\n            </p>`\n            : ''\n          }\n        </div>\n\n        ${this.getDiscountsAndGifts()}\n      </div>\n    `;\n  }\n}\n\n@customElement('discounter-summary')\nexport class DiscounterSummary extends LitElement {\n  static override styles = css`\n    table {\n      width: 100%;\n    }\n    .visually-hidden {\n      border: 0;\n      clip: rect(0, 0, 0, 0);\n      clip: rect(0 0 0 0);\n      width: 2px;\n      height: 2px;\n      margin: -2px;\n      overflow: hidden;\n      padding: 0;\n      position: absolute;\n      white-space: nowrap;\n    }\n    .discounter-summary .icon {\n      fill: currentColor;\n      height: 18px;\n      width: 18px;\n    }\n    tbody tr:first-child .name {\n      padding-top: 0px;\n    }\n    .name.loading, .price.loading {\n      padding-top: 8px;\n    }\n    .name {\n      font-size: 14px;\n      font-weight: 400;\n      text-align: left;\n    }\n    .name span:nth-child(2) {\n      margin-left: 8px;\n    }\n    .price {\n      font-size: 14px;\n      font-weight: 600;\n      text-align: right;\n    }\n    .name.loading::after {\n      width: 80px;\n    }\n\n    .price.loading {\n      width: 80px;\n    }\n    .name.loading::after,\n    .price.loading::after {\n      animation: pulse 1s infinite;\n      background-color: var(--discounter-loading-bg, #f0f0fa);\n      border-radius: 3px;\n      content: \"\";\n      color: transparent;\n      display: list-item;\n    }\n    .footer .name {\n      font-size: 16px;\n      font-weight: 400;\n    }\n    .footer .currency {\n      font-size: 12px;\n      font-weight: 400;\n      vertical-align: 0.2em;\n      margin-right: 0.5em;\n    }\n    .footer .emphasis {\n      font-size: 24px;\n      font-weight: 600;\n      letter-spacing: -0.04em;\n      line-height: 1em;\n    }\n    .footer .name,\n    .footer .price {\n      line-height: 1.3em;\n      padding-top: 3em;\n      white-space: nowrap;\n    }\n    .footer .payment-due {\n      position: sticky;\n    }\n    .footer .payment-due::after {\n      background-color: rgba(162,170,172,0.34);\n      content: '';\n      position: absolute;\n      top: 1.2em;\n      left: 0;\n      width: 100%;\n      height: 1px;\n    }\n    @keyframes pulse {\n      0%, 100% {\n        opacity: 1\n      }\n      50% {\n        opacity: 0;\n      }\n    }\n  `;\n\n  constructor() {\n    super();\n    window.addEventListener('discounter-update', ((\n      event: CustomEvent\n    ) => {\n      this.data = event.detail.data;\n    }) as EventListener);\n  }\n\n  private _getDiscounts(moneyFormat: string) {\n    if (this.data.checkout.applied_discounts.length) {\n      return html`\n        ${\n          this.data.checkout.applied_discounts.map(discount => {\n            const price = discount.value_type === \"shipping\" ?\n              window.discounter_i18n?.free_shipping || 'Free shipping':\n              `- ${formatMoney(+discount.amount * 100, moneyFormat)}`;\n\n            return html`<tr class=\"reduction-code\">\n            <th class=\"name\" scope=\"row\">\n              <span>${window.discounter_i18n?.discount || \"Discount\"}</span>\n              <span>\n                ${DISCOUNT_ICON}\n                <span class=\"text\">${discount.title.toUpperCase()}</span>\n              </span>\n            </th>\n    \n            <td class=\"price\">\n              <span class=\"emphasis\" aria-hidden=\"true\">${price}</span>\n              <span class=\"visually-hidden\">\n                ${price} of total order price\n              </span>\n            </td>\n          </tr>`;\n          })\n        }\n      `;\n    }\n\n    return ''\n  }\n\n  private _getGiftCards(moneyFormat: string) {\n    if (this.data.checkout.gift_cards.length) {\n      return html`\n        ${\n          this.data.checkout.gift_cards.map(giftCard => {\n            return html`<tr class=\"reduction-code\">\n                <th class=\"name\" scope=\"row\">\n                  <span>${window.discounter_i18n?.gift_card || \"Gift card\"}</span>\n                  <span>\n                    ${GIFT_ICON}\n                    <span class=\"text\">\n                      <span aria-hidden=\"true\">•••• ${giftCard.last_characters.toUpperCase()}</span>\n                      <span class=\"visually-hidden\">\n                        Gift card ending with ${giftCard.last_characters.toUpperCase()}\n                      </span>\n                    </span>\n                  </span>\n                </th>\n\n                <td class=\"price\">\n                  <span class=\"emphasis\">\n                    - ${formatMoney(\n                        +giftCard.presentment_amount_used * 100,\n                        moneyFormat\n                      )}\n                  </span>\n                </td>\n              </tr>`;\n          })\n        }\n      `;\n    }\n\n    return ''\n  }\n\n  private dataFetcher = new DataController(this);\n\n  @state()\n  private data: CheckoutData = this.dataFetcher._data;\n\n  override render() {\n    if (this.dataFetcher._error) {\n      return '';\n    }\n\n    if (!this.data.checkout.total_line_items_price) {\n      return html`\n        <div class=\"discounter-summary\">\n          <table class=\"table\">\n            <caption class=\"visually-hidden\">\n              ${window.discounter_i18n?.summary || \"Cost summary\"}\n            </caption>\n            <thead>\n              <tr>\n                <th scope=\"col\">\n                  <span class=\"visually-hidden\">${window.discounter_i18n?.description || \"Description\"}</span>\n                </th>\n                <th scope=\"col\">\n                  <span class=\"visually-hidden\">${window.discounter_i18n?.price || \"Price\"}</span>\n                </th>\n              </tr>\n            </thead>\n            <tbody class=\"tbody\">\n              <tr class=\"subtotal\">\n                <th class=\"name\" scope=\"row\">${window.discounter_i18n?.subtotal || \"Subtotal\"}</th>\n                <td class=\"price loading\"></td>\n              </tr>\n\n              <tr class=\"reduction-code\">\n                <th class=\"name loading\" scope=\"row\"></th>\n                <td class=\"price loading\"></td>\n              </tr>\n            </tbody>\n            <tfoot class=\"footer\">\n              <tr class=\"payment-due\">\n                <th class=\"name\" scope=\"row\">${window.discounter_i18n?.total || \"Total\"}</th>\n                <td class=\"price loading\"></td>\n              </tr>\n            </tfoot>\n          </table>\n        </div>\n      `;\n    }\n\n    return html`\n      <div class=\"discounter-summary\">\n        <table class=\"table\">\n          <caption class=\"visually-hidden\">\n            ${window.discounter_i18n?.summary || \"Cost summary\"}\n          </caption>\n          <thead>\n            <tr>\n              <th scope=\"col\">\n                <span class=\"visually-hidden\">${window.discounter_i18n?.description || \"Description\"}</span>\n              </th>\n              <th scope=\"col\">\n                <span class=\"visually-hidden\">${window.discounter_i18n?.price || \"Price\"}</span>\n              </th>\n            </tr>\n          </thead>\n          <tbody class=\"tbody\">\n            <tr class=\"subtotal\">\n              <th class=\"name\" scope=\"row\">${window.discounter_i18n?.subtotal || \"Subtotal\"}</th>\n              <td class=\"price\">\n                <span class=\"emphasis\">\n                  ${formatMoney(\n                    +this.data.checkout.total_line_items_price * 100,\n                    this.data.checkout.currency_format.format\n                  )}\n                </span>\n              </td>\n            </tr>\n\n            ${this._getDiscounts(this.data.checkout.currency_format.format)}\n            ${this._getGiftCards(this.data.checkout.currency_format.format)}\n          </tbody>\n          <tfoot class=\"footer\">\n            <tr class=\"payment-due\">\n              <th class=\"name\" scope=\"row\">${window.discounter_i18n?.total || \"Total\"}</th>\n              <td class=\"price\">\n                <span class=\"currency\">${this.data.checkout.presentment_currency}</span>\n                <span class=\"emphasis\">\n                  ${formatMoney(\n                    +this.data.checkout.payment_due * 100,\n                    this.data.checkout.currency_format.format\n                  )}\n                </span>\n              </td>\n            </tr>\n          </tfoot>\n        </table>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'discounter-form': DiscounterForm;\n  }\n  interface Window {\n    discounter_i18n: {\n      tooltip: string,\n      empty_msg: string,\n      placeholder: string,\n      apply: string,\n      error_msg: string,\n      free_shipping: string,\n      discount: string,\n      gift_card: string,\n      summary: string,\n      description: string,\n      price: string,\n      subtotal: string,\n      total: string\n    }\n  }\n}\n"]}