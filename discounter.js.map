{"version":3,"file":"discounter.js","sourceRoot":"","sources":["src/discounter.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {LitElement, html, css} from 'lit';\nimport {customElement, state} from 'lit/decorators.js';\nimport { CLOSE_ICON, DISCOUNT_ICON, GIFT_ICON, SPINNER_ICON } from './constants';\nimport { DataController, GiftCard, CheckoutData } from './data-controller';\n\n/**\n * An example element.\n *\n * @fires count-changed - Indicates when the count changes\n * @slot - This element has a slot\n * @csspart button - The button\n */\n@customElement('discounter-form')\nexport class DiscounterForm extends LitElement {\n  static override styles = css`\n    .discounter-component__form--wrapper {\n      padding: 6px\n    }\n    .discounter-component__form {\n      display: flex;\n      gap: 12px;\n    }\n    .discounter-component__form input {\n      border-radius: 5px;\n      padding: 13px 11px;\n    }\n    .discounter-component__form input.error {\n      border: 1px solid #ff6d6d;\n    }\n    .discounter-component__form button {\n      border-radius: 5px;\n      background: black;\n      color: white;\n      padding: 0 24px;\n      position: relative;\n    }\n    .discounter-component__form button.loading {\n      padding: 0px 24px;\n    }\n    .discounter-component__form button[disabled] {\n      cursor: not-allowed;\n      opacity: 0.4;\n    }\n    .discounter-component__form button svg {\n      visibility: hidden;\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      margin-top: -10px;\n      margin-left: -10px;\n      transition: opacity 0.3s ease-in-out;\n      opacity: 0;\n    }\n    .discounter-component__form button.loading span {\n      visibility: hidden;\n    }\n    .discounter-component__form button.loading svg {\n      animation: rotate 0.5s linear infinite;\n      visibility: visible;\n      opacity: 1;\n    }\n    .discounter-component__message {\n      color: #ff6d6d;\n      margin: 8px 0 4px;\n    }\n    .discounter-component__codes {\n      display: flex;\n      gap: 10px;\n      margin-top: 12px;\n    }\n    .discounter-component__code {\n      background-color: rgba(113, 113, 113, 0.11);\n      border-radius: 5px;\n      color: #717171;\n      display: inline-flex;\n      gap: 8px;\n      padding: 10px;\n    }\n    .discounter-component__code span {\n      align-items: center;\n      display: flex;\n      font-size: 13px;\n      font-weight: 600;\n      gap: 8px;\n    }\n    .discounter-component .icon {\n      fill: currentColor;\n      height: 18px;\n      width: 18px;\n    }\n    .discounter-component__code button {\n      background: transparent;\n      border: 0;\n      cursor: pointer;\n      padding: 0;\n    }\n    .discounter-component__code button .icon {\n      height: 16px;\n      width: 16px;\n    }\n    .discounter-component__code button .spinner_icon {\n      animation: rotate 0.5s linear infinite;\n    }\n    .discounter-component__code button .close_icon,\n    .discounter-component__code button.loading .spinner_icon {\n      display: block;\n    }\n    .discounter-component__code button .spinner_icon,\n    .discounter-component__code button.loading .close_icon {\n      display: none;\n    }\n    @keyframes rotate {\n      0% {\n        transform: rotate(0);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n  `;\n\n  @state()\n  private data: CheckoutData = {\n    checkout: {\n      applied_discounts: [],\n      gift_cards: [],\n      total_discount_amount: \"\",\n    }\n  };\n\n  @state()\n  private hide = false;\n\n  @state()\n  private error = false;\n\n  @state()\n  private loading = false;\n\n  @state()\n  private disabled = true;\n\n  @state()\n  private code = '';\n\n  private dataFetcher = new DataController(this);\n\n  handleInput(event: InputEvent) {\n    this.error = false;\n    this.code = (event.target as HTMLInputElement)?.value;\n  }\n\n  private async applyCode() {\n    if (!this.code.length) {\n      return;\n    }\n\n    this.loading = true;\n\n    try {\n      await this.dataFetcher.applyCode(this.code);\n      this.loading = false;\n    } catch (error) {\n      this.loading = false;\n      this.error = true;\n      console.log(error);\n    }\n  }\n\n  private getDiscountsAndGifts() {\n    if (\n      this.dataFetcher._discounts.length ||\n      this.dataFetcher._gift_cards.length\n    ) {\n      return html`<div class=\"discounter-component__codes\">\n        ${this.dataFetcher._discounts.map((discount: {title: string}) => {\n\n          return html`\n            <div class=\"discounter-component__code\">\n              <span>\n                ${DISCOUNT_ICON}\n                <span>${discount.title}</span>\n              </span>\n              <button\n                type=\"button\"\n                @click=${(event: Event) => this.dataFetcher.clearDiscount(event, discount.title)}\n              >\n                ${CLOSE_ICON}\n                ${SPINNER_ICON}\n              </button>\n            </div>\n          `;\n        })}\n\n        ${this.dataFetcher._gift_cards.map((gift_card: GiftCard) => {\n\n          return html`\n            <div class=\"discounter-component__code\">\n              <span>\n                ${GIFT_ICON}\n                <span>•••• ${gift_card.last_characters}</span>\n              </span>\n              <button\n                type=\"button\"\n                @click=${(event: Event) => this.dataFetcher.clearGiftCard(event, gift_card)}\n              >\n                ${CLOSE_ICON}\n                ${SPINNER_ICON}\n              </button>\n            </div>\n          `;\n        })}\n      </div>`;\n    }\n\n    return '';\n  }\n\n  override render() {\n    if (this.hide) {\n      return '';\n    }\n\n    const classes = this.loading ? 'button loading': 'button';\n    const errorClass = this.error ? 'error' : '';\n\n    return html`\n      <div class=\"discounter-component\">\n        <div class=\"discounter-component__form--wrapper\">\n          <div class=\"discounter-component__form\">\n            <input\n              type=\"text\"\n              class=${errorClass}\n              placeholder=\"Gift card or discount code\"\n              .value=${this.code}\n              @input=${this.handleInput}\n            >\n            <button\n              type=\"submit\"\n              class=${classes}\n              ?disabled=${this.disabled || !this.code.length}\n              @click=${this.applyCode}\n            >\n              <span>Apply</span>\n              ${SPINNER_ICON}\n            </button>\n          </div>\n\n          ${\n            this.error\n            ? html`<p class=\"discounter-component__message\">Enter a valid discount code or gift card</p>`\n            : ''\n          }\n        </div>\n\n        ${this.getDiscountsAndGifts()}\n      </div>\n    `;\n  }\n}\n\n@customElement('discounter-summary')\nexport class DiscounterSummary extends LitElement {\n  private dataFetcher = new DataController(this);\n  override render() {\n    const data = this.dataFetcher._data;\n\n    return html`\n      <div class=\"discounter-component\">\n        <h1>${data.checkout.total_discount_amount}</h1>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'discounter-form': DiscounterForm;\n  }\n}\n"]}